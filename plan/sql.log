-- 题库表
CREATE TABLE questions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    type ENUM('choice', 'calculation', 'proof') NOT NULL COMMENT '题型',
    content TEXT NOT NULL COMMENT '题目内容（含LaTeX公式）',
    difficulty TINYINT(1) DEFAULT 3 COMMENT '难度1-5',
    solution TEXT COMMENT '标准答案',
    hint_pattern VARCHAR(50) COMMENT '规则引擎标识符'
);

-- 知识点标签表
CREATE TABLE question_tags (
    question_id INT,
    tag VARCHAR(50) COMMENT '如"二次函数","相似三角形"',
    FOREIGN KEY (question_id) REFERENCES questions(id)
);

-- 规则引擎表
CREATE TABLE hint_rules (
    id INT PRIMARY KEY AUTO_INCREMENT,
    pattern_id VARCHAR(50) NOT NULL COMMENT '规则标识',
    trigger_keywords JSON COMMENT '触发关键词数组',
    hint_text TEXT NOT NULL COMMENT '提示内容'
);

-- 学生答题记录表（Demo核心）
CREATE TABLE answer_records (
    id INT PRIMARY KEY AUTO_INCREMENT,
    question_id INT,
    student_input TEXT COMMENT '学生输入步骤',
    used_hint TEXT COMMENT '使用的提示',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (question_id) REFERENCES questions(id)
);

-- 插入中考真题（简化版）
INSERT INTO questions (type, content, difficulty, solution, hint_pattern) VALUES
('choice', '已知二次函数 $y=x^2+2x-3$，其顶点坐标为（    ）\nA. (1, -4)  B. (-1, -4)  C. (1, 4)  D. (-1, 4)', 3, 'B（顶点公式 $x=-\\frac{b}{2a}$ 计算）', 'vertex_formula'),
('calculation', '解方程：$2(x-3)^2 = 18$', 4, '$x=6$ 或 $x=0$（两边开方后移项）', 'square_root'),
('proof', '如图，$\\triangle ABC$中$\\angle C=90^\\circ$，$D$为$AB$中点。求证：$CD = \\frac{1}{2}AB$', 5, '连接$CD$，用直角三角形斜边中线定理', 'right_triangle_theorem');

-- 规则配置
INSERT INTO hint_rules (pattern_id, trigger_keywords, hint_text) VALUES
('vertex_formula', '["顶点", "坐标", "对称轴"]', '提示：二次函数 $y=ax^2+bx+c$ 的顶点坐标公式为 $\\left(-\\frac{b}{2a}, \\frac{4ac-b^2}{4a}\\right)$'),
('square_root', '["开方", "平方", "根"]', '注意：方程 $x^2=k$ 的解为 $x=\\pm\\sqrt{k}$，需考虑正负两种情况');

-- 插入初三数学题目（低中高各3题）
INSERT INTO questions (type, content, difficulty, solution, hint_pattern) VALUES
-- 初级题目（难度1-2）
('choice', '二次函数 $y=x^2-4x+3$ 的对称轴是（   ）\nA. $x=1$  B. $x=2$  C. $x=3$  D. $x=4$', 1, 'B（对称轴公式 $x=-\\frac{b}{2a}$）', 'vertex_formula'),
('calculation', '解方程：$2(x-3) = 10$', 2, '$x=8$（两边除以2后加3）', 'linear_equation'),
('proof', '如图，$\\triangle ABC$中 $AB=AC$，$D$为$BC$中点。求证：$AD \\perp BC$', 2, '等腰三角形三线合一性质', 'isosceles_property'),

-- 中级题目（难度3）
('choice', '抛物线 $y=2x^2+4x-1$ 的顶点坐标为（   ）\nA. (-1,-3)  B. (-1,3)  C. (1,-3)  D. (1,3)', 3, 'A（$x=-\\frac{b}{2a}=-1$，代入得$y=-3$）', 'quadratic_vertex'),
('calculation', '计算：$\\sqrt{25} + \\left| -3 \\right| \\times 2^2 - \\frac{12}{4}$', 3, '$5 + 3\\times4 - 3 = 14$', 'arithmetic_ops'),
('proof', '如图，$\\square ABCD$中$E,F$分别为$AB,CD$中点。求证：$EF$平分对角线$AC$', 3, '连接AE,CF，利用平行四边形性质', 'parallelogram_prop'),

-- 高级题目（难度4-5）
('choice', '二次函数 $y=ax^2+bx+c$ 图象如图所示（开口向下，顶点在第二象限），则（   ）\nA. $a>0,b>0,c>0$  B. $a<0,b<0,c<0$  C. $a<0,b>0,c>0$  D. $a<0,b<0,c>0$', 4, 'D（开口向下$a<0$，对称轴$>0$得$b<0$，y轴截距$>0$得$c>0$）', 'quadratic_analysis'),
('calculation', '若 $\\alpha,\\beta$ 是方程 $x^2-5x+3=0$ 的两根，求 $\\alpha^2 + \\beta^2$ 的值', 5, '$\\alpha+\\beta=5$，$\\alpha\\beta=3$，$\\alpha^2+\\beta^2=(\\alpha+\\beta)^2-2\\alpha\\beta=19$', 'quadratic_roots'),
('proof', '如图，$AB$是$\\odot O$直径，$C$在圆上，$CD\\perp AB$于$D$。求证：$CD^2=AD\\cdot DB$', 5, '连接AC,BC，用射影定理或相似三角形证明', 'circle_theorem');

-- 关联题目与知识点
INSERT INTO question_tags (question_id, tag) VALUES
(1, '二次函数'), (1, '对称轴'),
(2, '一元一次方程'),
(3, '等腰三角形'), (3, '三线合一'),
(4, '二次函数'), (4, '顶点坐标'),
(5, '实数运算'), (5, '绝对值'),
(6, '平行四边形'), (6, '中位线'),
(7, '二次函数'), (7, '图象性质'),
(8, '一元二次方程'), (8, '韦达定理'),
(9, '圆'), (9, '射影定理');

